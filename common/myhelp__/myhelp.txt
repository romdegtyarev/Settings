Основные Linux команды:
----------
pwd                                              Вывод пути до текущего каталога
ls                                               Вывод содержимого текущего каталога
lsblk                                            Вывод блочных устройств
df                                               Вывод файловых систем
lsusb                                            Вывод USB портов
lsipc                                            Вывод информации об объектах IPC, которые в настоящее время используются системой
ipcs                                             Вывод Информации об объектах IPC
lsof                                             Вывод списка открытых файлов
cd                                               Смена дириктории
mkdir dir                                        Создание директории dir
rmdir dir                                        Удаление директории dir
touch file                                       Создание файла file
cat                                              Направление файлов на стандартный вывод
cp src dst                                       Копирование
rm file/dir                                      Удаление файлов/директорий
rm -r                                            Рекурсивное удаление
rm -f                                            Удаление без подтверждения
ln -s src dst                                    Создание ссылки dst на src
mount /dev/sda1 /mnt/                            Монтирование /dev/sda1 в /mnt/
umount /dev/sda1                                 Отмонтировать /dev/sda1
alias newName='Comand'                           Псевдонимы команд
chmod                                            Изменить права доступа (Владелец, Группа, Остальные (Чтение, Запись, Выполнение))
htop                                             Список запущенных процессов
chown -R group:name                              Сменить влельца файлов/директорий
ps ax                                            Список всех запущенных процессов
kill proc                                        Остановка процесса с номером proc
script                                           Запись сеанса терминала
echo "String"                                    Вывод String на стандартный вывод
echo "String" > ./file                           Записать в file String
echo "String" >> ./file                          Дописать в file String
tr                                               Редактор строк
sed                                              Редактор строк
awk                                              Редактор строк
grep string file                                 Поиск строк string в file
grep -r string ./                                Рекурсивный поиск строк string во всех файла находящихся в ./
grep -i                                          Необращать внимание на регистр
grep -с                                          Показать количество найденых строк
grep -n                                          Указывать номера найденных строк
grep -v                                          Обратный grep, вывод если не найдено
find / -name 'name'                              Поиск файлов в / по имени name
find -type f/d/l/p/s                             Поиск по типу
find -exec command {} \;                         Выполнить действия command над найдеными
ssh -P port user@*.*.*.*                         Подключиться по SSH
scp -P port user@*.*.*.*:/dir/file ./            Скопировать файл с удаленного сервера по SSH
scp -P port ./file user@*.*.*.*:/dir/            Скопировать файл на удаленный сервер по SSH
ping                                             Проверка целостности и качества соединений
traceroute                                       Определение маршрутов следования данных
ipcacl IP MASK                                   Расчет подсети
route                                            Показать маршруты
ip route show                                    Показать маршруты
ip del *.*.*.*/* via *.*.*.*                     Удалить маршрут
ip add *.*.*.*/* via *.*.*.*                     Добавить маршрут
ip addr add *.*.*.*/* dev eth0                   Добавить IP
ip addr del *.*.*.*/* dev eth0                   Удалить IP
ip a                                             Показать информацию о интерфейсах
ifconfig                                         Показать информацию о интерфейсах
sudo ip link set mtu 9000 dev eth0               Задать значение MTU 9000 на интерфейсе eth0
vconfig add eth0 20                              Поднять 20 VLAN на eth0
arp -a                                           Показать arp таблицу
netstat -a                                       Состояние всех сокетов
netstat -r                                       Маршруты
whois                                            Информация о домене или IP адресе
nslookup                                         Информация о домене
tcpdump -i eth0                                  Захват данных с интерфейса eth0
nmap                                             Сканировние сети
echo 0 > /proc/sys/kernel/printk                 Отключить сообщения ядра
ifconfig eth0.20 hw ether 60:e3:27:00:d7:36      Изменить MAC на eth0.20 на 60:e3:27:00:d7:36
----------
tar:
----------
tar -cvf archive.tar ./dir               Создание архива  archive.tar c папкой ./dir
tar -cvzf archive.tar.gz ./dir           Создание архива archive.tar.gz с папкой ./dir
tar -cvjf archive.tar.bz2 ./dir          Создание архива archive.tar.bz2 с папкой ./dir
tar -cvJf archive.tar.xz ./dir           Создание архива archive.tar.xz с папкой ./dir
tar -xvf ./archive.tar -C ./dir          Извлечение архива ./archive.tar в ./dir
tar -tf archive.tar                      Созержимое архима archive.tar
----------
git:
----------
git init                                 Создание репозитория
git status                               Состояние проекта
git log                                  Информация о коммитах
git add files                            Добавление изменений файлов files
git rm files                             Удаление файлов files
git commit -m "comment"                  Сдедание коммита с коментарием comment
git remote add origin URL                Добавление удаленного репа origin
git push RepName master:master           Сделание Push репа RepName
git remote -v                            Список подлюченных удаленных репов
git clone URL                            Клонирование удаленного репа
git diff                                 Сравнение веток, комитов
git reset                                Возврат к определенному комиту
git branch newBrunch                     Создание ветки newBrunch
git branch -d newBranch                  Удаление ветки newBranch, если есть merge
git branch -D newBranch                  Удаление ветки в любом случае
git checkout newBranch                   Переход на ветку newBranch
git merge newBranch                      Слиение текущей ветки с newBranch
----------
vim основное:
----------
i                                        Режим редактирования
v                                        Редим выделения
y                                        Копирование
p                                        Вставка
V                                        Выделение строки
CTL+SHIFT+v                              Вставка из буфера
h, j, k, l                               Перемешение
CTRL+U, CTRL+D                           Старница вверх, вниз
w, b                                     Перемещение по словам
H, L                                     Перемещение в начало и в конец экрана
/                                        Поиск
:2                                       Перейти ко 2 строке
----------
tmux:
----------
Prefix+o                                 Переход на следующее окно
Prifix+Alt+2                             Закрытие окна
Prefix+Alt+4                             Новое окно
Prifix+p(n)                              Следующая (предыдущая вкладка)
Prefix+c                                 Новая вкладка
Prefix+z                                 Разворачивание окно
CTRL+a                                   Переход в начало строки
Prefix+:                                 Открыть командную строку TMUX
setw synchronize-panes on (off)          Включить (выключить) синхронный ввод во все панели в текущей вкладке. Вводить в командную строку TMUX
----------
Настройка NAT:
----------
Проверить значение "cat /proc/sys/net/ipv4/ip_forward". Должно быть "1".
В файле "/etc/sysctl.conf" установить значение "ipv4.ip_forward" равным "1".
Затем выполнить команду: "sudo iptables -t nat -A POSTROUTING -o DEVICE_WITH_NET -j MASQUERADE".
----------
Выполнить сканирование изображения:
----------
scascanimage —device `hpaio:/usb/Deskjet_1510_series?serial=CN35O1DKRW05YR' —format=tiff >test.tiffnimage -L
----------
SSH Multiplexing:
----------
ControlMaster auto
ControlPath /tmp/ssh_mux_%h_%p_%r
ControlPersist 4h
----------
SSH Debug:
----------
Для Ubuntu ввести команду для остановки демона:
sudo service ssh stop
Для сервера:
sudo /usr/sbin/sshd -ddd (количество d уровень дебага, приложение останавливается если закрылся сокет)
Для клиента:
ssh admin@10.10.10.10 -vvv (количество v уровень дебага)
----------
SSH Тонель:
----------
/usr/bin/ssh -f -N -R 555:localhost:22 -p 666 admin@10.10.10.10
----------
Изменение размеров изображеия:
----------
convert -resize 512x image.jpg image.png
convert -resize x512 image.jpg image.png
----------
Установка DSCP:
----------
sudo iptables -t mangle -A OUTPUT -j DSCP --set-dscp 31
----------
Проблемы с wireshark:
----------
sudo chmod 755 /usr/bin/dumpcap
----------
Проблемы с wireshark на macOS:
----------
cd /dev
sudo chown AliGht:admin bp*
----------
Функция для отслеживания памяти:
----------
mtrace()
----------
Настройка wg:
----------
Сервер:
/etc/wireguard/wg0.conf
[Interface]
Address = 192.168.0.1/24
ListenPort = 443 // Любой
PrivateKey = SERVER_PRIVATE_KEY

[Peer]
AllowedIPs = 192.168.0.2/24
PublicKey = CLIENT_PUBLIC_KEY

Клиент:
/etc/wireguard/wg0.conf
[Interface]
Address = 192.168.0.2/24
PrivateKey = CLIENT_PRIVATE_KEY
DNS = 8.8.8.8

[Peer]
PublicKey = SERVER_PUBLIC_KEY
AllowedIPs = 0.0.0.0/0        // Чтобы весь свой трафик слать через этот сервер
Endpoint = 10.10.10.10:443    // Публичный IP сервера
PersistentKeepalive = 25      // На всякий случай, чтобы пробивать NAT

Затем:
systemctl restart wg-quick@wg0.service
На стороне сервера настроить NAT в iptables и включить форвардинг.
Поднять интерфейс:
sudo wg-quick up wg0
Опустить интерфейс:
sudo wg-quick down wg0
Показать информацию:
sudo wg show
----------
vim полный:
----------
hjkl                                             перемещение в разные стороны
i                         режим вставки
I                         добавление в начало строки
a                         режим добавления
A                         добавление в конец строки
o                         добавить строку сразу за текущей
O                         добавить строку перед текущей
R                         писать поверх имеющегося текста
u, :u[ndo]                отмена предыдущего действия (undo)
CTR-R, :red[o]            отмена отмены предыдущего действия (redo)
dd                        вырезать (удалить) строку
cc                        удалить и начать редактирование
yy                        копировать строку
p                         вставить из буфера обмена
<n>d                      удалить n+1 строку
<n>y                      скопировать n+1 строку
ESC                       перейти в режим просмотра
DEL                       удалить следующий символ
:<n>                      перейти на строку #n
%                         перейти к парной скобке
:e **/filename.c          редактировать файл (с поиском по имени)
:w [fname]                записать изменения
:wa                       сохранить изменения во всех файлах
:q                        выйти из редактора
:q!                       выйти из редактора, не сохраняя изменения
:color <name>             выбор цветовой схемы. цветвые схемы:
                            /usr/local/share/vim/vim72/colors/*.vim
:pwd                      текущий каталог
:cd [path]                перейти в другой каталог
:!команда                 выполнить команду - man, git, и так далее
                            стрелочками веерх и вниз можно автодополнять
                            команды и искать по истории
CTR+p или CTR+n           автоматическое дополнение текста
                            (в режиме редактирования)
CTR+r,=,<expr>            вставить выражение, например 5*2 - 3
                            (в режиме редактирования)
CTR+u, CTR+d              Page Up / Page Down
CTR+y, CTR+e              Перемотка вверх/вниз без движения курсора

:syntax on                включить подсветку
:syntax off               выключить подсветку (по умолчанию)

:set wrap                 разрешить word wrap (по умолчанию)
:set nowrap               запретить word wrap

:ha[rdcopy]                   распечатать документ
:set printoptions=duplex:off  отключить двустороннюю печать

zc                        свернуть блок
zo                        развернуть блок
zM                        закрыть все блоки
zR                        открыть все блоки
za                        инвертирование
zf                        см :set foldmethod=manual
:set foldenable           включить свoрачивание
:set foldmethod=syntax    сворачивание на основе синтаксиса
:set foldmethod=indent    сворачивание на основе отступов
:set foldmethod=manual    выделяем участок с помощью v и говорим zf
:set foldmethod=marker    сворачивание на основе маркеров в тексте
:set foldmarker=bigin,end задаем маркеры начала и конца блока

ma                        установить локальный маркер a
mB                        установить глобальный маркер B
`c                        перейти к локальному маркеру c
`0                        вернуться на позицию, на которой закончили
                            работу при закрытии vim
:marks                    просмотр маркеров
set viminfo='1000,f1      маркеры пишутся в ~/.viminfo, восстанавливаясь
                            при следующем запуске vim. маркер " хранит
                            последнюю позицию курсора в файле
mksession file.session    сохранить текущую сессию
source file.session       восстановить ранее сохраненную сессию

qa                        записать макрос с именем a
q                         в режиме записи макроса: закончить запись
@a                        выполнить макрос с именем a
@@                        повторить последний макрос

"ayy                      скопировать строку в регистр a
"bdd                      вырезать строку и поместить в регистр b
"С2d                      вырезать три строки и дописать в конец
                            регистра C
:reg [name1][name2][...]  просмотреть содержимое регистров

v + hjkl                  выделение текста
SHIFT + v                 выделить строку
CTR + v                   выделение прямоугольника
p                         вставить
y                         копировать
d                         удалить
gu                        к нижнему регистру
gU                        к верхнему регистру

[#]>                      сдвинуть выделенное вправо
[#]<                      сдвинуть выделенное влево
[#]>>                     сдвинуть строку вправо
[#]<<                     сдвинуть строку влево
set tabstop=#             для табуляции используется # пробелов
set shiftwidth=#          в командах отступа используется # пробелов
set [no]expandtab         заменять ли табуляцию на соответствующее
                            число пробелов

/Выражение               поиск выражения в файле
\cВыражение              поиск без учета регистра
n                        следующее совпадение
N                        предыдущее совпадение
:%s/foo/bar/gi           замена строк, см http://eax.me/regular-expr/

:vimgrep /EXPR/ **/*.c   поиск по регулярному выражению
:copen                   показать все найденные места
:close                   скрыть все найденные места
:cn                      переход к следующему результату
:cp                      переход к предыдущему результату

:set number              включить нумерацию строк
:set nonumber            отключить нумерацию строк

:tabnew [fname]          создать таб
:tabs                    вывести список табов
:tabn                    следующий таб
:tabp                    предыдущий таб
<n>gt                    перейти на таб #n
gt                       следующий таб
gT                       предыдущий таб
:tabm +1                 переместить таб вперед на одну позицию
:tabm -1                 переместить таб назад на одну позицию
:tabm 2                  переместить таб на заданную позицию
                           (нумерация начинается с нуля)

:split                   горизонтальное разбиение
:vsplit                  вертикальное разбиение
Ctr+W, затем
  с                      закрыть окно
  +-                     изменение высоты текущего окна
  <>                     изменение ширины текущего окна
  =                      установить равный размер окон
  hjkl или стрелочки              перемещение между окнами

    mkdir -p ~/.vim/spell
    cd ~/.vim/spell
    wget http://ftp.vim.org/vim/runtime/spell/ru.koi8-r.sug
    wget http://ftp.vim.org/vim/runtime/spell/ru.koi8-r.spl
    wget http://ftp.vim.org/vim/runtime/spell/en.ascii.sug
    wget http://ftp.vim.org/vim/runtime/spell/en.ascii.spl

:set spell spelllang=ru,en        включить проверку орфографии
:set nospell                      выключить проверку орфографии
]s                                следующее слово с ошибкой
[s                                предыдущее слово с ошибкой
z=                                замена слова на альтернативу из списка
zg                                good word
zw                                wrong word
zG                                ignore word

e ++enc=<имя кодировки>           Редактирование файла в ??? кодировке
w ++enc=<имя кодировки>           Сохранить файл в новой кодировке
set fileencodings=utf-8,koi8-r    Список автоматически определяемых
                                  кодировок в порядке убывания
                                  приоритета

:set [no]wildmenu                 При авто-дополнении в командной строке над
                                  ней выводятся возможные варианты
:set list                         Отображать табуляцию и переводы строк
q:                                История команд
.                                 Повторение последней команды
----------
tcpdump / снифер / sniffer

Установка

yum install tcpdump - установка в centos
apt install tcpdump - установка в debian

Опции утилиты tcpdump:

-i интерфейс # Задает интерфейс, с которого необходимо анализировать трафик (без указания интерфейса - анализ "первого попавшегося")
-n           # Отключает преобразование IP в доменные имена. Если указано -nn, то запрещается преобразование номеров портов в название протокола.
-e           # Включает вывод данных канального уровня (например, MAC-адреса).
-v           # Вывод дополнительной информации (TTL, опции IP).
-s размер    # Указание размера захватываемых пакетов. (по умолчанию - пакеты больше 68 байт)
-w имя_файла # Задать имя файла, в который сохранять собранную информацию.
-r имя_файла # Чтение дампа из заданного файла.
-p           # Захватывать только трафик, предназначенный данному узлу. (по умолчанию - захват всех пакетов, например в том числе широковещательных).
-q           # Переводит tcpdump в "бесшумный режим", пакет анализируется на транспортном уровне (протоколы TCP, UDP, ICMP), а не на сетевом (протокол IP).
-t           # Отключает вывод меток времени.


Наиболее часто используемые фильтрующие параметры команды tcpdump:

dst хост     # Проверяет, совпадает ли адрес получателя IP-пакета с указанным значением. 
             # Возможно задавать как IP, подсеть в формате 10.0.0.1/24, так и имя хоста.

src хост     # Проверяет, совпадает ли адрес отправителя IP пакета с указанным значением. 
             # Возможно задавать как IP, подсеть в формате 10.0.0.1/24, так и имя хоста.

host хост    # Проверяет, совпадает ли адрес отправителя или получателя с заданным значением. 
             # Возможно задавать как IP, подсеть в формате 10.0.0.1/24, так и имя хоста.

net имя_сети # Проверяется, находится ли адрес отправителя/получателя в заданной сети. 
             # Возможно указание сети в формате CIDR (например 10.0.0.1/22), либо указание имени сети, 
             # заданной в файле /etc/networks.


ip | arp | rarp | tcp | udp | icmp [хост]    # Проверяет, принадлежит ли пакет одному из указанных протоколов и при указании адреса хоста проверяет, 
                                             # совпадает ли адрес отправителя\получателя с заданным. 
                                             # Возможно задавать как IP, подсеть в формате 10.0.0.1/24, так и имя хоста.

[tcp | udp] dst port номер_порта             # Проверяется, принадлежит ли пакет протоколу TCP/UDP и равен ли порт назначения заданному. 
                                             # Можно указать номер порта, либо имя, заданное в файле /etc/services.

[tcp | udp] src port номер_порта             # Проверяется, принадлежит ли пакет протоколу TCP/UDP и равен ли порт источника заданному.
                                             # Можно указать номер порта, либо имя, заданное в файле /etc/services.     

[tcp | udp] port номер_порта                 # Проверяется, принадлежит ли пакет протоколу TCP/UDP и равен ли порт назначения или источника заданному. 
                                             # Можно указать номер порта, либо имя, заданное в файле /etc/services.

ether { src | dst | host } MAC_адрес         # Проверяется, принадлежит ли сетевой пакет источнику, назначению, 
                                             # источнику или назначению имеющему заданный MAC_адрес.


ip broadcast                                 # Проверяется, является ли IP пакет широковещательным.

ether broadcast                              # Проверяется, является ли ARP-пакет широковещательным.
----------


